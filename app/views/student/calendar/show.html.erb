<div class="container mx-auto px-4 py-8">
  <div class="mb-6">
    <h1 class="text-3xl font-bold">Calendar</h1>
    <p class="text-gray-600 mt-1">
      Program: <%= link_to @program.name, student_dashboard_path, class: "text-blue-600 hover:text-blue-800" %>
    </p>
  </div>

  <div class="bg-white shadow rounded-lg p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
      <div class="flex gap-2">
        <%= link_to "← Previous",
            student_department_program_calendar_path(@department, @program, date: @date - 1.week, view: @view_mode),
            class: "bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700" %>
        <%= link_to "Today",
            student_department_program_calendar_path(@department, @program, date: Date.current, view: @view_mode),
            class: "bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" %>
        <%= link_to "Next →",
            student_department_program_calendar_path(@department, @program, date: @date + 1.week, view: @view_mode),
            class: "bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700" %>
      </div>
      <div class="flex gap-2">
        <%= link_to "Single Day",
            student_department_program_calendar_path(@department, @program, date: @date, view: "single"),
            class: "bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 #{@view_mode == 'single' ? 'opacity-75' : ''}" %>
        <%= link_to "Week View",
            student_department_program_calendar_path(@department, @program, date: @date, view: "multi"),
            class: "bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 #{@view_mode == 'multi' ? 'opacity-75' : ''}" %>
      </div>
    </div>

    <h2 class="text-xl font-semibold mb-4">
      <% if @view_mode == "single" %>
        <%= @date.strftime("%B %d, %Y") %>
      <% else %>
        Week of <%= @date.beginning_of_week.strftime("%B %d, %Y") %>
      <% end %>
    </h2>
  </div>

  <div class="bg-white shadow rounded-lg p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Calendar Events</h2>
    <% if @calendar_events.any? %>
      <ul class="divide-y divide-gray-200">
        <% @calendar_events.each do |event| %>
          <li class="py-4">
            <h3 class="font-semibold"><%= event.title %></h3>
            <p class="text-sm text-gray-500">
              <%= event.start_time.strftime("%B %d, %Y at %I:%M %p") %> -
              <%= event.end_time.strftime("%I:%M %p") %>
            </p>
            <% if event.description.present? %>
              <p class="mt-2 text-gray-700"><%= event.description %></p>
            <% end %>
            <% if event.participating_faculty.any? %>
              <p class="mt-2 text-sm text-gray-600">
                With: <%= event.participating_faculty.map(&:display_name).join(", ") %>
              </p>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-gray-500">No calendar events scheduled.</p>
    <% end %>
  </div>

  <div class="bg-white shadow rounded-lg p-6">
    <h2 class="text-xl font-semibold mb-4">My Appointments</h2>
    <% if @my_appointments.any? %>
      <ul class="divide-y divide-gray-200">
        <% @my_appointments.each do |appointment| %>
          <li class="py-4">
            <h3 class="font-semibold"><%= appointment.vip.display_name %></h3>
            <p class="text-sm text-gray-500">
              <%= appointment.start_time.strftime("%B %d, %Y at %I:%M %p") %> -
              <%= appointment.end_time.strftime("%I:%M %p") %>
            </p>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-gray-500">No appointments scheduled.</p>
    <% end %>
  </div>
</div>
